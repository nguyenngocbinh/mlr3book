<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6.3 Adding new PipeOps | mlr3 book</title>
  <meta name="description" content="6.3 Adding new PipeOps | mlr3 book" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="6.3 Adding new PipeOps | mlr3 book" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://mlr3book.mlr-org.com/" />
  <meta property="og:image" content="https://mlr3book.mlr-org.com//block.png" />
  
  <meta name="github-repo" content="mlr-org/mlr3book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6.3 Adding new PipeOps | mlr3 book" />
  
  
  <meta name="twitter:image" content="https://mlr3book.mlr-org.com//block.png" />

<meta name="author" content="Marc Becker" />
<meta name="author" content="Martin Binder" />
<meta name="author" content="Bernd Bischl" />
<meta name="author" content="Michel Lang" />
<meta name="author" content="Florian Pfisterer" />
<meta name="author" content="Nicholas G. Reich" />
<meta name="author" content="Jakob Richter" />
<meta name="author" content="Patrick Schratz" />
<meta name="author" content="Raphael Sonabend" />


<meta name="date" content="2021-06-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="extending-measures.html"/>
<link rel="next" href="extending-tuners.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">mlr3 Manual <img src='https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/logo.png' width=30 /></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Citation Info</a></li>
<li class="chapter" data-level="" data-path="quickstart.html"><a href="quickstart.html"><i class="fa fa-check"></i>Quickstart</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction and Overview</a></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>2.1</b> Quick R6 Intro for Beginners</a></li>
<li class="chapter" data-level="2.2" data-path="tasks.html"><a href="tasks.html"><i class="fa fa-check"></i><b>2.2</b> Tasks</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="tasks.html"><a href="tasks.html#tasks-types"><i class="fa fa-check"></i><b>2.2.1</b> Task Types</a></li>
<li class="chapter" data-level="2.2.2" data-path="tasks.html"><a href="tasks.html#tasks-creation"><i class="fa fa-check"></i><b>2.2.2</b> Task Creation</a></li>
<li class="chapter" data-level="2.2.3" data-path="tasks.html"><a href="tasks.html#tasks-predefined"><i class="fa fa-check"></i><b>2.2.3</b> Predefined tasks</a></li>
<li class="chapter" data-level="2.2.4" data-path="tasks.html"><a href="tasks.html#tasks-api"><i class="fa fa-check"></i><b>2.2.4</b> Task API</a>
<ul>
<li class="chapter" data-level="2.2.4.1" data-path="tasks.html"><a href="tasks.html#tasks-retrieving"><i class="fa fa-check"></i><b>2.2.4.1</b> Retrieving Data</a></li>
<li class="chapter" data-level="2.2.4.2" data-path="tasks.html"><a href="tasks.html#tasks-roles"><i class="fa fa-check"></i><b>2.2.4.2</b> Roles (Rows and Columns)</a></li>
<li class="chapter" data-level="2.2.4.3" data-path="tasks.html"><a href="tasks.html#tasks-mutators"><i class="fa fa-check"></i><b>2.2.4.3</b> Task Mutators</a></li>
</ul></li>
<li class="chapter" data-level="2.2.5" data-path="tasks.html"><a href="tasks.html#autoplot-task"><i class="fa fa-check"></i><b>2.2.5</b> Plotting Tasks</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="learners.html"><a href="learners.html"><i class="fa fa-check"></i><b>2.3</b> Learners</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="learners.html"><a href="learners.html#predefined-learners"><i class="fa fa-check"></i><b>2.3.1</b> Predefined Learners</a></li>
<li class="chapter" data-level="2.3.2" data-path="learners.html"><a href="learners.html#learner-api"><i class="fa fa-check"></i><b>2.3.2</b> Learner API</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="train-predict.html"><a href="train-predict.html"><i class="fa fa-check"></i><b>2.4</b> Train, Predict, Score</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="train-predict.html"><a href="train-predict.html#train-predict-objects"><i class="fa fa-check"></i><b>2.4.1</b> Creating Task and Learner Objects</a></li>
<li class="chapter" data-level="2.4.2" data-path="train-predict.html"><a href="train-predict.html#split-data"><i class="fa fa-check"></i><b>2.4.2</b> Setting up the train/test splits of the data</a></li>
<li class="chapter" data-level="2.4.3" data-path="train-predict.html"><a href="train-predict.html#training"><i class="fa fa-check"></i><b>2.4.3</b> Training the learner</a></li>
<li class="chapter" data-level="2.4.4" data-path="train-predict.html"><a href="train-predict.html#predicting"><i class="fa fa-check"></i><b>2.4.4</b> Predicting</a></li>
<li class="chapter" data-level="2.4.5" data-path="train-predict.html"><a href="train-predict.html#predict-type"><i class="fa fa-check"></i><b>2.4.5</b> Changing the Predict Type</a></li>
<li class="chapter" data-level="2.4.6" data-path="train-predict.html"><a href="train-predict.html#autoplot-prediction"><i class="fa fa-check"></i><b>2.4.6</b> Plotting Predictions</a></li>
<li class="chapter" data-level="2.4.7" data-path="train-predict.html"><a href="train-predict.html#measure"><i class="fa fa-check"></i><b>2.4.7</b> Performance assessment</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="resampling.html"><a href="resampling.html"><i class="fa fa-check"></i><b>2.5</b> Resampling</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="resampling.html"><a href="resampling.html#resampling-settings"><i class="fa fa-check"></i><b>2.5.1</b> Settings</a></li>
<li class="chapter" data-level="2.5.2" data-path="resampling.html"><a href="resampling.html#resampling-inst"><i class="fa fa-check"></i><b>2.5.2</b> Instantiation</a></li>
<li class="chapter" data-level="2.5.3" data-path="resampling.html"><a href="resampling.html#resampling-exec"><i class="fa fa-check"></i><b>2.5.3</b> Execution</a></li>
<li class="chapter" data-level="2.5.4" data-path="resampling.html"><a href="resampling.html#resamp-custom"><i class="fa fa-check"></i><b>2.5.4</b> Custom resampling</a></li>
<li class="chapter" data-level="2.5.5" data-path="resampling.html"><a href="resampling.html#resampling-with-predefined-groups"><i class="fa fa-check"></i><b>2.5.5</b> Resampling with predefined groups</a></li>
<li class="chapter" data-level="2.5.6" data-path="resampling.html"><a href="resampling.html#autoplot-resampleresult"><i class="fa fa-check"></i><b>2.5.6</b> Plotting Resample Results</a></li>
<li class="chapter" data-level="2.5.7" data-path="resampling.html"><a href="resampling.html#autoplot-resample-partition"><i class="fa fa-check"></i><b>2.5.7</b> Plotting Resample Partitions</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="benchmarking.html"><a href="benchmarking.html"><i class="fa fa-check"></i><b>2.6</b> Benchmarking</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="benchmarking.html"><a href="benchmarking.html#bm-design"><i class="fa fa-check"></i><b>2.6.1</b> Design Creation</a></li>
<li class="chapter" data-level="2.6.2" data-path="benchmarking.html"><a href="benchmarking.html#bm-exec"><i class="fa fa-check"></i><b>2.6.2</b> Execution and Aggregation of Results</a></li>
<li class="chapter" data-level="2.6.3" data-path="benchmarking.html"><a href="benchmarking.html#autoplot-benchmarkresult"><i class="fa fa-check"></i><b>2.6.3</b> Plotting Benchmark Results</a></li>
<li class="chapter" data-level="2.6.4" data-path="benchmarking.html"><a href="benchmarking.html#bm-resamp"><i class="fa fa-check"></i><b>2.6.4</b> Extracting ResampleResults</a></li>
<li class="chapter" data-level="2.6.5" data-path="benchmarking.html"><a href="benchmarking.html#converting-and-merging"><i class="fa fa-check"></i><b>2.6.5</b> Converting and Merging</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="binary-classification.html"><a href="binary-classification.html"><i class="fa fa-check"></i><b>2.7</b> Binary classification</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="binary-classification.html"><a href="binary-classification.html#binary-roc"><i class="fa fa-check"></i><b>2.7.1</b> ROC Curve and Thresholds</a></li>
<li class="chapter" data-level="2.7.2" data-path="binary-classification.html"><a href="binary-classification.html#threshold-tuning"><i class="fa fa-check"></i><b>2.7.2</b> Threshold Tuning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>3</b> Model Optimization</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tuning.html"><a href="tuning.html"><i class="fa fa-check"></i><b>3.1</b> Hyperparameter Tuning</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="tuning.html"><a href="tuning.html#tuning-optimization"><i class="fa fa-check"></i><b>3.1.1</b> The <code>TuningInstance*</code> Classes</a></li>
<li class="chapter" data-level="3.1.2" data-path="tuning.html"><a href="tuning.html#tuning-algorithms"><i class="fa fa-check"></i><b>3.1.2</b> The <code>Tuner</code> Class</a></li>
<li class="chapter" data-level="3.1.3" data-path="tuning.html"><a href="tuning.html#tuning-triggering"><i class="fa fa-check"></i><b>3.1.3</b> Triggering the Tuning</a></li>
<li class="chapter" data-level="3.1.4" data-path="tuning.html"><a href="tuning.html#autotuner"><i class="fa fa-check"></i><b>3.1.4</b> Automating the Tuning</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="searchspace.html"><a href="searchspace.html"><i class="fa fa-check"></i><b>3.2</b> Tuning Search Spaces</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="searchspace.html"><a href="searchspace.html#creating-paramsets"><i class="fa fa-check"></i><b>3.2.1</b> Creating <code>ParamSet</code>s</a></li>
<li class="chapter" data-level="3.2.2" data-path="searchspace.html"><a href="searchspace.html#searchspace-trafo"><i class="fa fa-check"></i><b>3.2.2</b> Transformations (<code>trafo</code>)</a></li>
<li class="chapter" data-level="3.2.3" data-path="searchspace.html"><a href="searchspace.html#autolevel"><i class="fa fa-check"></i><b>3.2.3</b> Automatic Factor Level Transformation</a></li>
<li class="chapter" data-level="3.2.4" data-path="searchspace.html"><a href="searchspace.html#searchspace-depends"><i class="fa fa-check"></i><b>3.2.4</b> Parameter Dependencies (<code>depends</code>)</a></li>
<li class="chapter" data-level="3.2.5" data-path="searchspace.html"><a href="searchspace.html#creating-tuning-paramsets-from-other-paramsets"><i class="fa fa-check"></i><b>3.2.5</b> Creating Tuning ParamSets from other ParamSets</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="nested-resampling.html"><a href="nested-resampling.html"><i class="fa fa-check"></i><b>3.3</b> Nested Resampling</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="nested-resampling.html"><a href="nested-resampling.html#nested-resamp-exec"><i class="fa fa-check"></i><b>3.3.1</b> Execution</a></li>
<li class="chapter" data-level="3.3.2" data-path="nested-resampling.html"><a href="nested-resampling.html#nested-resamp-eval"><i class="fa fa-check"></i><b>3.3.2</b> Evaluation</a></li>
<li class="chapter" data-level="3.3.3" data-path="nested-resampling.html"><a href="nested-resampling.html#nested-final-model"><i class="fa fa-check"></i><b>3.3.3</b> Final Model</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="hyperband.html"><a href="hyperband.html"><i class="fa fa-check"></i><b>3.4</b> Tuning with Hyperband</a></li>
<li class="chapter" data-level="3.5" data-path="fs.html"><a href="fs.html"><i class="fa fa-check"></i><b>3.5</b> Feature Selection / Filtering</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="fs.html"><a href="fs.html#fs-filter"><i class="fa fa-check"></i><b>3.5.1</b> Filters</a></li>
<li class="chapter" data-level="3.5.2" data-path="fs.html"><a href="fs.html#fs-calc"><i class="fa fa-check"></i><b>3.5.2</b> Calculating filter values</a></li>
<li class="chapter" data-level="3.5.3" data-path="fs.html"><a href="fs.html#fs-var-imp-filters"><i class="fa fa-check"></i><b>3.5.3</b> Variable Importance Filters</a></li>
<li class="chapter" data-level="3.5.4" data-path="fs.html"><a href="fs.html#fs-wrapper"><i class="fa fa-check"></i><b>3.5.4</b> Wrapper Methods</a></li>
<li class="chapter" data-level="3.5.5" data-path="fs.html"><a href="fs.html#fs-wrapper-optimization"><i class="fa fa-check"></i><b>3.5.5</b> The <code>FSelectInstance</code> Classes</a></li>
<li class="chapter" data-level="3.5.6" data-path="fs.html"><a href="fs.html#the-fselector-class"><i class="fa fa-check"></i><b>3.5.6</b> The <code>FSelector</code> Class</a></li>
<li class="chapter" data-level="3.5.7" data-path="fs.html"><a href="fs.html#wrapper-selection-triggering"><i class="fa fa-check"></i><b>3.5.7</b> Triggering the Tuning</a></li>
<li class="chapter" data-level="3.5.8" data-path="fs.html"><a href="fs.html#autofselect"><i class="fa fa-check"></i><b>3.5.8</b> Automating the Feature Selection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pipelines.html"><a href="pipelines.html"><i class="fa fa-check"></i><b>4</b> Pipelines</a>
<ul>
<li class="chapter" data-level="4.1" data-path="pipe-pipeops.html"><a href="pipe-pipeops.html"><i class="fa fa-check"></i><b>4.1</b> The Building Blocks: PipeOps</a></li>
<li class="chapter" data-level="4.2" data-path="pipe-operator.html"><a href="pipe-operator.html"><i class="fa fa-check"></i><b>4.2</b> The Pipeline Operator: <code>%&gt;&gt;%</code></a></li>
<li class="chapter" data-level="4.3" data-path="pipe-nodes-edges-graphs.html"><a href="pipe-nodes-edges-graphs.html"><i class="fa fa-check"></i><b>4.3</b> Nodes, Edges and Graphs</a></li>
<li class="chapter" data-level="4.4" data-path="pipe-modeling.html"><a href="pipe-modeling.html"><i class="fa fa-check"></i><b>4.4</b> Modeling</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="pipe-modeling.html"><a href="pipe-modeling.html#pipe-hyperpars"><i class="fa fa-check"></i><b>4.4.1</b> Setting Hyperparameters</a></li>
<li class="chapter" data-level="4.4.2" data-path="pipe-modeling.html"><a href="pipe-modeling.html#pipe-tuning"><i class="fa fa-check"></i><b>4.4.2</b> Tuning</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html"><i class="fa fa-check"></i><b>4.5</b> Non-Linear Graphs</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#pipe-model-ensembles-branching-copying"><i class="fa fa-check"></i><b>4.5.1</b> Branching &amp; Copying</a></li>
<li class="chapter" data-level="4.5.2" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#pipe-model-ensembles"><i class="fa fa-check"></i><b>4.5.2</b> Model Ensembles</a>
<ul>
<li class="chapter" data-level="4.5.2.1" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#pipe-model-ensembles-bagging"><i class="fa fa-check"></i><b>4.5.2.1</b> Bagging</a></li>
<li class="chapter" data-level="4.5.2.2" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#pipe-model-ensembles-stacking"><i class="fa fa-check"></i><b>4.5.2.2</b> Stacking</a></li>
<li class="chapter" data-level="4.5.2.3" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#multilevel-stacking"><i class="fa fa-check"></i><b>4.5.2.3</b> Multilevel Stacking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html"><i class="fa fa-check"></i><b>4.6</b> Special Operators</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html#imputation-pipeopimpute"><i class="fa fa-check"></i><b>4.6.1</b> Imputation: <code>PipeOpImpute</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html#feature-engineering-pipeopmutate"><i class="fa fa-check"></i><b>4.6.2</b> Feature Engineering: <code>PipeOpMutate</code></a></li>
<li class="chapter" data-level="4.6.3" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html#training-on-data-subsets-pipeopchunk"><i class="fa fa-check"></i><b>4.6.3</b> Training on data subsets: <code>PipeOpChunk</code></a></li>
<li class="chapter" data-level="4.6.4" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html#feature-selection-pipeopfilter-and-pipeopselect"><i class="fa fa-check"></i><b>4.6.4</b> Feature Selection: <code>PipeOpFilter</code> and <code>PipeOpSelect</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html"><i class="fa fa-check"></i><b>4.7</b> In-depth look into mlr3pipelines</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#whats-the-point"><i class="fa fa-check"></i><b>4.7.1</b> What’s the Point</a></li>
<li class="chapter" data-level="4.7.2" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#pipeop-pipeline-operators"><i class="fa fa-check"></i><b>4.7.2</b> <code>PipeOp</code>: Pipeline Operators</a>
<ul>
<li class="chapter" data-level="4.7.2.1" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#why-the-state"><i class="fa fa-check"></i><b>4.7.2.1</b> Why the <code>$state</code></a></li>
<li class="chapter" data-level="4.7.2.2" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#where-to-get-pipeops"><i class="fa fa-check"></i><b>4.7.2.2</b> Where to Get <code>PipeOp</code>s</a></li>
</ul></li>
<li class="chapter" data-level="4.7.3" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#pipeop-channels"><i class="fa fa-check"></i><b>4.7.3</b> PipeOp Channels</a>
<ul>
<li class="chapter" data-level="4.7.3.1" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#input-channels"><i class="fa fa-check"></i><b>4.7.3.1</b> Input Channels</a></li>
<li class="chapter" data-level="4.7.3.2" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#output-channels"><i class="fa fa-check"></i><b>4.7.3.2</b> Output Channels</a></li>
<li class="chapter" data-level="4.7.3.3" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#channel-configuration"><i class="fa fa-check"></i><b>4.7.3.3</b> Channel Configuration</a></li>
</ul></li>
<li class="chapter" data-level="4.7.4" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#graph-networks-of-pipeops"><i class="fa fa-check"></i><b>4.7.4</b> <code>Graph</code>: Networks of <code>PipeOp</code>s</a>
<ul>
<li class="chapter" data-level="4.7.4.1" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#basics-1"><i class="fa fa-check"></i><b>4.7.4.1</b> Basics</a></li>
<li class="chapter" data-level="4.7.4.2" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#networks"><i class="fa fa-check"></i><b>4.7.4.2</b> Networks</a></li>
<li class="chapter" data-level="4.7.4.3" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#syntactic-sugar"><i class="fa fa-check"></i><b>4.7.4.3</b> Syntactic Sugar</a></li>
<li class="chapter" data-level="4.7.4.4" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#pipeop-ids-and-id-name-clashes"><i class="fa fa-check"></i><b>4.7.4.4</b> <code>PipeOp</code> IDs and ID Name Clashes</a></li>
</ul></li>
<li class="chapter" data-level="4.7.5" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#learners-in-graphs-graphs-in-learners"><i class="fa fa-check"></i><b>4.7.5</b> Learners in Graphs, Graphs in Learners</a>
<ul>
<li class="chapter" data-level="4.7.5.1" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#pipeoplearner"><i class="fa fa-check"></i><b>4.7.5.1</b> <code>PipeOpLearner</code></a></li>
<li class="chapter" data-level="4.7.5.2" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#graphlearner"><i class="fa fa-check"></i><b>4.7.5.2</b> <code>GraphLearner</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7.6" data-path="in-depth-pipelines.html"><a href="in-depth-pipelines.html#hyperparameters"><i class="fa fa-check"></i><b>4.7.6</b> Hyperparameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="technical.html"><a href="technical.html"><i class="fa fa-check"></i><b>5</b> Technical</a>
<ul>
<li class="chapter" data-level="5.1" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>5.1</b> Parallelization</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="parallelization.html"><a href="parallelization.html#implicit-parallelization"><i class="fa fa-check"></i><b>5.1.1</b> Implicit Parallelization</a></li>
<li class="chapter" data-level="5.1.2" data-path="parallelization.html"><a href="parallelization.html#explicit-parallelization"><i class="fa fa-check"></i><b>5.1.2</b> Explicit Parallelization</a></li>
<li class="chapter" data-level="5.1.3" data-path="parallelization.html"><a href="parallelization.html#nested-resampling-parallelization"><i class="fa fa-check"></i><b>5.1.3</b> Nested Resampling Parallelization</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="error-handling.html"><a href="error-handling.html"><i class="fa fa-check"></i><b>5.2</b> Error Handling</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="error-handling.html"><a href="error-handling.html#encapsulation"><i class="fa fa-check"></i><b>5.2.1</b> Encapsulation</a></li>
<li class="chapter" data-level="5.2.2" data-path="error-handling.html"><a href="error-handling.html#fallback-learners"><i class="fa fa-check"></i><b>5.2.2</b> Fallback learners</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="backends.html"><a href="backends.html"><i class="fa fa-check"></i><b>5.3</b> Database Backends</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="backends.html"><a href="backends.html#use-case-nyc-flights"><i class="fa fa-check"></i><b>5.3.1</b> Use Case: NYC Flights</a></li>
<li class="chapter" data-level="5.3.2" data-path="backends.html"><a href="backends.html#preprocessing-with-dplyr"><i class="fa fa-check"></i><b>5.3.2</b> Preprocessing with <code>dplyr</code></a></li>
<li class="chapter" data-level="5.3.3" data-path="backends.html"><a href="backends.html#databackenddplyr"><i class="fa fa-check"></i><b>5.3.3</b> DataBackendDplyr</a></li>
<li class="chapter" data-level="5.3.4" data-path="backends.html"><a href="backends.html#model-fitting"><i class="fa fa-check"></i><b>5.3.4</b> Model fitting</a></li>
<li class="chapter" data-level="5.3.5" data-path="backends.html"><a href="backends.html#cleanup"><i class="fa fa-check"></i><b>5.3.5</b> Cleanup</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="paradox.html"><a href="paradox.html"><i class="fa fa-check"></i><b>5.4</b> Parameters (using <code>paradox</code>)</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="paradox.html"><a href="paradox.html#reference-based-objects"><i class="fa fa-check"></i><b>5.4.1</b> Reference Based Objects</a></li>
<li class="chapter" data-level="5.4.2" data-path="paradox.html"><a href="paradox.html#defining-a-parameter-space"><i class="fa fa-check"></i><b>5.4.2</b> Defining a Parameter Space</a>
<ul>
<li class="chapter" data-level="5.4.2.1" data-path="paradox.html"><a href="paradox.html#single-parameters"><i class="fa fa-check"></i><b>5.4.2.1</b> Single Parameters</a></li>
<li class="chapter" data-level="5.4.2.2" data-path="paradox.html"><a href="paradox.html#parameter-sets"><i class="fa fa-check"></i><b>5.4.2.2</b> Parameter Sets</a></li>
<li class="chapter" data-level="5.4.2.3" data-path="paradox.html"><a href="paradox.html#vector-parameters"><i class="fa fa-check"></i><b>5.4.2.3</b> Vector Parameters</a></li>
</ul></li>
<li class="chapter" data-level="5.4.3" data-path="paradox.html"><a href="paradox.html#parameter-sampling"><i class="fa fa-check"></i><b>5.4.3</b> Parameter Sampling</a>
<ul>
<li class="chapter" data-level="5.4.3.1" data-path="paradox.html"><a href="paradox.html#parameter-designs"><i class="fa fa-check"></i><b>5.4.3.1</b> Parameter Designs</a></li>
<li class="chapter" data-level="5.4.3.2" data-path="paradox.html"><a href="paradox.html#grid-design"><i class="fa fa-check"></i><b>5.4.3.2</b> Grid Design</a></li>
<li class="chapter" data-level="5.4.3.3" data-path="paradox.html"><a href="paradox.html#random-sampling"><i class="fa fa-check"></i><b>5.4.3.3</b> Random Sampling</a></li>
<li class="chapter" data-level="5.4.3.4" data-path="paradox.html"><a href="paradox.html#generalized-sampling-the-sampler-class"><i class="fa fa-check"></i><b>5.4.3.4</b> Generalized Sampling: The <code>Sampler</code> Class</a></li>
</ul></li>
<li class="chapter" data-level="5.4.4" data-path="paradox.html"><a href="paradox.html#parameter-transformation"><i class="fa fa-check"></i><b>5.4.4</b> Parameter Transformation</a>
<ul>
<li class="chapter" data-level="5.4.4.1" data-path="paradox.html"><a href="paradox.html#transformation-between-types"><i class="fa fa-check"></i><b>5.4.4.1</b> Transformation between Types</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="logging.html"><a href="logging.html"><i class="fa fa-check"></i><b>5.5</b> Logging</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="logging.html"><a href="logging.html#changing-mlr3-logging-levels"><i class="fa fa-check"></i><b>5.5.1</b> Changing mlr3 logging levels</a></li>
<li class="chapter" data-level="5.5.2" data-path="logging.html"><a href="logging.html#redirecting-output"><i class="fa fa-check"></i><b>5.5.2</b> Redirecting output</a></li>
<li class="chapter" data-level="5.5.3" data-path="logging.html"><a href="logging.html#immediate-log-feedback"><i class="fa fa-check"></i><b>5.5.3</b> Immediate Log Feedback</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="extending.html"><a href="extending.html"><i class="fa fa-check"></i><b>6</b> Extending</a>
<ul>
<li class="chapter" data-level="6.1" data-path="extending-learners.html"><a href="extending-learners.html"><i class="fa fa-check"></i><b>6.1</b> Adding new Learners</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="extending-learners.html"><a href="extending-learners.html#setup"><i class="fa fa-check"></i><b>6.1.1</b> Setting-up mlr3extralearners</a></li>
<li class="chapter" data-level="6.1.2" data-path="extending-learners.html"><a href="extending-learners.html#create-learner"><i class="fa fa-check"></i><b>6.1.2</b> Calling create_learner</a></li>
<li class="chapter" data-level="6.1.3" data-path="extending-learners.html"><a href="extending-learners.html#learner_package_type_key.r"><i class="fa fa-check"></i><b>6.1.3</b> learner_package_type_key.R</a></li>
<li class="chapter" data-level="6.1.4" data-path="extending-learners.html"><a href="extending-learners.html#learner-meta-information"><i class="fa fa-check"></i><b>6.1.4</b> Meta-information</a></li>
<li class="chapter" data-level="6.1.5" data-path="extending-learners.html"><a href="extending-learners.html#param-set"><i class="fa fa-check"></i><b>6.1.5</b> ParamSet</a></li>
<li class="chapter" data-level="6.1.6" data-path="extending-learners.html"><a href="extending-learners.html#learner-train"><i class="fa fa-check"></i><b>6.1.6</b> Train function</a></li>
<li class="chapter" data-level="6.1.7" data-path="extending-learners.html"><a href="extending-learners.html#learner-predict"><i class="fa fa-check"></i><b>6.1.7</b> Predict function</a></li>
<li class="chapter" data-level="6.1.8" data-path="extending-learners.html"><a href="extending-learners.html#learner-control"><i class="fa fa-check"></i><b>6.1.8</b> Control objects/functions of learners</a></li>
<li class="chapter" data-level="6.1.9" data-path="extending-learners.html"><a href="extending-learners.html#learner-test"><i class="fa fa-check"></i><b>6.1.9</b> Testing the learner</a>
<ul>
<li class="chapter" data-level="6.1.9.1" data-path="extending-learners.html"><a href="extending-learners.html#learner-test-manual"><i class="fa fa-check"></i><b>6.1.9.1</b> Train and Predict</a></li>
<li class="chapter" data-level="6.1.9.2" data-path="extending-learners.html"><a href="extending-learners.html#learner-test-unit"><i class="fa fa-check"></i><b>6.1.9.2</b> Autotest</a></li>
<li class="chapter" data-level="6.1.9.3" data-path="extending-learners.html"><a href="extending-learners.html#learner-test-parameter"><i class="fa fa-check"></i><b>6.1.9.3</b> Checking Parameters</a></li>
</ul></li>
<li class="chapter" data-level="6.1.10" data-path="extending-learners.html"><a href="extending-learners.html#cleaning"><i class="fa fa-check"></i><b>6.1.10</b> Package Cleaning</a></li>
<li class="chapter" data-level="6.1.11" data-path="extending-learners.html"><a href="extending-learners.html#thanks-and-maintenance"><i class="fa fa-check"></i><b>6.1.11</b> Thanks and Maintenance</a></li>
<li class="chapter" data-level="6.1.12" data-path="extending-learners.html"><a href="extending-learners.html#learner-faq"><i class="fa fa-check"></i><b>6.1.12</b> Learner FAQ</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="extending-measures.html"><a href="extending-measures.html"><i class="fa fa-check"></i><b>6.2</b> Adding new Measures</a></li>
<li class="chapter" data-level="6.3" data-path="extending-pipeops.html"><a href="extending-pipeops.html"><i class="fa fa-check"></i><b>6.3</b> Adding new PipeOps</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="extending-pipeops.html"><a href="extending-pipeops.html#ext-pipeopcopy"><i class="fa fa-check"></i><b>6.3.1</b> General Case Example: <code>PipeOpCopy</code></a>
<ul>
<li class="chapter" data-level="6.3.1.1" data-path="extending-pipeops.html"><a href="extending-pipeops.html#first-steps-inheriting-from-pipeop"><i class="fa fa-check"></i><b>6.3.1.1</b> First Steps: Inheriting from <code>PipeOp</code></a></li>
<li class="chapter" data-level="6.3.1.2" data-path="extending-pipeops.html"><a href="extending-pipeops.html#channel-definitions"><i class="fa fa-check"></i><b>6.3.1.2</b> Channel Definitions</a></li>
<li class="chapter" data-level="6.3.1.3" data-path="extending-pipeops.html"><a href="extending-pipeops.html#train-and-predict"><i class="fa fa-check"></i><b>6.3.1.3</b> Train and Predict</a></li>
<li class="chapter" data-level="6.3.1.4" data-path="extending-pipeops.html"><a href="extending-pipeops.html#putting-it-together"><i class="fa fa-check"></i><b>6.3.1.4</b> Putting it Together</a></li>
</ul></li>
<li class="chapter" data-level="6.3.2" data-path="extending-pipeops.html"><a href="extending-pipeops.html#ext-pipe-preproc"><i class="fa fa-check"></i><b>6.3.2</b> Special Case: Preprocessing</a>
<ul>
<li class="chapter" data-level="6.3.2.1" data-path="extending-pipeops.html"><a href="extending-pipeops.html#example-pipeopdropna"><i class="fa fa-check"></i><b>6.3.2.1</b> Example: <code>PipeOpDropNA</code></a></li>
<li class="chapter" data-level="6.3.2.2" data-path="extending-pipeops.html"><a href="extending-pipeops.html#example-pipeopscalealways"><i class="fa fa-check"></i><b>6.3.2.2</b> Example: <code>PipeOpScaleAlways</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3.3" data-path="extending-pipeops.html"><a href="extending-pipeops.html#special-case-preprocessing-with-simple-train"><i class="fa fa-check"></i><b>6.3.3</b> Special Case: Preprocessing with Simple Train</a>
<ul>
<li class="chapter" data-level="6.3.3.1" data-path="extending-pipeops.html"><a href="extending-pipeops.html#example-pipeopdropconst"><i class="fa fa-check"></i><b>6.3.3.1</b> Example: <code>PipeOpDropConst</code></a></li>
<li class="chapter" data-level="6.3.3.2" data-path="extending-pipeops.html"><a href="extending-pipeops.html#example-pipeopscalealwayssimple"><i class="fa fa-check"></i><b>6.3.3.2</b> Example: <code>PipeOpScaleAlwaysSimple</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3.4" data-path="extending-pipeops.html"><a href="extending-pipeops.html#ext-pipe-hyperpars"><i class="fa fa-check"></i><b>6.3.4</b> Hyperparameters</a>
<ul>
<li class="chapter" data-level="6.3.4.1" data-path="extending-pipeops.html"><a href="extending-pipeops.html#hyperparameter-example-pipeopscale"><i class="fa fa-check"></i><b>6.3.4.1</b> Hyperparameter Example: <code>PipeOpScale</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="extending-tuners.html"><a href="extending-tuners.html"><i class="fa fa-check"></i><b>6.4</b> Adding new Tuners</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="extending-tuners.html"><a href="extending-tuners.html#extending-tuners-summary"><i class="fa fa-check"></i><b>6.4.1</b> Adding a new Tuner</a></li>
<li class="chapter" data-level="6.4.2" data-path="extending-tuners.html"><a href="extending-tuners.html#tuner-template"><i class="fa fa-check"></i><b>6.4.2</b> Template</a></li>
<li class="chapter" data-level="6.4.3" data-path="extending-tuners.html"><a href="extending-tuners.html#tuner-optimize"><i class="fa fa-check"></i><b>6.4.3</b> Optimize method</a>
<ul>
<li class="chapter" data-level="6.4.3.1" data-path="extending-tuners.html"><a href="extending-tuners.html#writing-a-custom-iteration"><i class="fa fa-check"></i><b>6.4.3.1</b> Writing a custom iteration</a></li>
<li class="chapter" data-level="6.4.3.2" data-path="extending-tuners.html"><a href="extending-tuners.html#calling-an-external-optimization-function"><i class="fa fa-check"></i><b>6.4.3.2</b> Calling an external optimization function</a></li>
</ul></li>
<li class="chapter" data-level="6.4.4" data-path="extending-tuners.html"><a href="extending-tuners.html#tuner-add-result"><i class="fa fa-check"></i><b>6.4.4</b> Assign result method</a></li>
<li class="chapter" data-level="6.4.5" data-path="extending-tuners.html"><a href="extending-tuners.html#tuner-from-optimizer"><i class="fa fa-check"></i><b>6.4.5</b> Transform optimizer to tuner</a></li>
<li class="chapter" data-level="6.4.6" data-path="extending-tuners.html"><a href="extending-tuners.html#tuner-test"><i class="fa fa-check"></i><b>6.4.6</b> Add unit tests</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="special-tasks.html"><a href="special-tasks.html"><i class="fa fa-check"></i><b>7</b> Special Tasks</a>
<ul>
<li class="chapter" data-level="7.1" data-path="survival.html"><a href="survival.html"><i class="fa fa-check"></i><b>7.1</b> Survival Analysis</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="survival.html"><a href="survival.html#tasksurv"><i class="fa fa-check"></i><b>7.1.1</b> TaskSurv</a></li>
<li class="chapter" data-level="7.1.2" data-path="survival.html"><a href="survival.html#predict-types---crank-lp-and-distr"><i class="fa fa-check"></i><b>7.1.2</b> Predict Types - crank, lp, and distr</a></li>
<li class="chapter" data-level="7.1.3" data-path="survival.html"><a href="survival.html#composition"><i class="fa fa-check"></i><b>7.1.3</b> Composition</a></li>
<li class="chapter" data-level="7.1.4" data-path="survival.html"><a href="survival.html#benchmark-experiment"><i class="fa fa-check"></i><b>7.1.4</b> Benchmark Experiment</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="density.html"><a href="density.html"><i class="fa fa-check"></i><b>7.2</b> Density Estimation</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="density.html"><a href="density.html#train-and-predict-1"><i class="fa fa-check"></i><b>7.2.1</b> Train and Predict</a></li>
<li class="chapter" data-level="7.2.2" data-path="density.html"><a href="density.html#benchmark-experiment-1"><i class="fa fa-check"></i><b>7.2.2</b> Benchmark Experiment</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="spatiotemporal.html"><a href="spatiotemporal.html"><i class="fa fa-check"></i><b>7.3</b> Spatiotemporal Analysis</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="spatiotemporal.html"><a href="spatiotemporal.html#creating-a-spatial-task"><i class="fa fa-check"></i><b>7.3.1</b> Creating a spatial Task</a></li>
<li class="chapter" data-level="7.3.2" data-path="spatiotemporal.html"><a href="spatiotemporal.html#spatiotemporal-intro"><i class="fa fa-check"></i><b>7.3.2</b> Autocorrelation</a></li>
<li class="chapter" data-level="7.3.3" data-path="spatiotemporal.html"><a href="spatiotemporal.html#sp-vs-nsp-cv"><i class="fa fa-check"></i><b>7.3.3</b> Spatial CV vs. Non-Spatial CV</a>
<ul>
<li class="chapter" data-level="7.3.3.1" data-path="spatiotemporal.html"><a href="spatiotemporal.html#nsp-cv"><i class="fa fa-check"></i><b>7.3.3.1</b> Non-Spatial CV</a></li>
<li class="chapter" data-level="7.3.3.2" data-path="spatiotemporal.html"><a href="spatiotemporal.html#sp-cv"><i class="fa fa-check"></i><b>7.3.3.2</b> Spatial CV</a></li>
</ul></li>
<li class="chapter" data-level="7.3.4" data-path="spatiotemporal.html"><a href="spatiotemporal.html#vis-spt-partitions"><i class="fa fa-check"></i><b>7.3.4</b> Visualization of Spatiotemporal Partitions</a></li>
<li class="chapter" data-level="7.3.5" data-path="spatiotemporal.html"><a href="spatiotemporal.html#vis-spatial-block"><i class="fa fa-check"></i><b>7.3.5</b> Spatial Block Visualization</a></li>
<li class="chapter" data-level="7.3.6" data-path="spatiotemporal.html"><a href="spatiotemporal.html#choose-spt-rsmp"><i class="fa fa-check"></i><b>7.3.6</b> Choosing a Resampling Method</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ordinal.html"><a href="ordinal.html"><i class="fa fa-check"></i><b>7.4</b> Ordinal Analysis</a></li>
<li class="chapter" data-level="7.5" data-path="functional.html"><a href="functional.html"><i class="fa fa-check"></i><b>7.5</b> Functional Analysis</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="functional.html"><a href="functional.html#how-to-model-functional-data"><i class="fa fa-check"></i><b>7.5.1</b> How to model functional data?</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="multilabel.html"><a href="multilabel.html"><i class="fa fa-check"></i><b>7.6</b> Multilabel Classification</a></li>
<li class="chapter" data-level="7.7" data-path="cost-sens.html"><a href="cost-sens.html"><i class="fa fa-check"></i><b>7.7</b> Cost-Sensitive Classification</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="cost-sens.html"><a href="cost-sens.html#a-first-model"><i class="fa fa-check"></i><b>7.7.1</b> A First Model</a></li>
<li class="chapter" data-level="7.7.2" data-path="cost-sens.html"><a href="cost-sens.html#cost-sensitive-measure"><i class="fa fa-check"></i><b>7.7.2</b> Cost-sensitive Measure</a></li>
<li class="chapter" data-level="7.7.3" data-path="cost-sens.html"><a href="cost-sens.html#thresholding"><i class="fa fa-check"></i><b>7.7.3</b> Thresholding</a></li>
<li class="chapter" data-level="7.7.4" data-path="cost-sens.html"><a href="cost-sens.html#threshold-tuning-1"><i class="fa fa-check"></i><b>7.7.4</b> Threshold Tuning</a></li>
<li class="chapter" data-level="7.7.5" data-path="cost-sens.html"><a href="cost-sens.html#adjusting-thresholds-two-strategies"><i class="fa fa-check"></i><b>7.7.5</b> Adjusting thresholds: Two strategies</a></li>
<li class="chapter" data-level="7.7.6" data-path="cost-sens.html"><a href="cost-sens.html#pipeopthreshold"><i class="fa fa-check"></i><b>7.7.6</b> PipeOpThreshold</a></li>
<li class="chapter" data-level="7.7.7" data-path="cost-sens.html"><a href="cost-sens.html#pipeoptunethreshold"><i class="fa fa-check"></i><b>7.7.7</b> PipeOpTunethreshold</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="interpretation.html"><a href="interpretation.html"><i class="fa fa-check"></i><b>8</b> Model Interpretation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="iml.html"><a href="iml.html"><i class="fa fa-check"></i><b>8.1</b> IML</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="iml.html"><a href="iml.html#penguin-task"><i class="fa fa-check"></i><b>8.1.1</b> Penguin Task</a></li>
<li class="chapter" data-level="8.1.2" data-path="iml.html"><a href="iml.html#featureeffects"><i class="fa fa-check"></i><b>8.1.2</b> FeatureEffects</a></li>
<li class="chapter" data-level="8.1.3" data-path="iml.html"><a href="iml.html#shapley"><i class="fa fa-check"></i><b>8.1.3</b> Shapley</a></li>
<li class="chapter" data-level="8.1.4" data-path="iml.html"><a href="iml.html#featureimp"><i class="fa fa-check"></i><b>8.1.4</b> FeatureImp</a></li>
<li class="chapter" data-level="8.1.5" data-path="iml.html"><a href="iml.html#independent-test-data"><i class="fa fa-check"></i><b>8.1.5</b> Independent Test Data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="dalex.html"><a href="dalex.html"><i class="fa fa-check"></i><b>8.2</b> DALEX</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="dalex.html"><a href="dalex.html#interpretability-dalex-introduction"><i class="fa fa-check"></i><b>8.2.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2.2" data-path="dalex.html"><a href="dalex.html#interpretability-data-fifa"><i class="fa fa-check"></i><b>8.2.2</b> Read data: FIFA</a></li>
<li class="chapter" data-level="8.2.3" data-path="dalex.html"><a href="dalex.html#interpretability-train-ranger"><i class="fa fa-check"></i><b>8.2.3</b> Train a model: Ranger</a></li>
<li class="chapter" data-level="8.2.4" data-path="dalex.html"><a href="dalex.html#interpretability-architecture"><i class="fa fa-check"></i><b>8.2.4</b> The general workflow</a></li>
<li class="chapter" data-level="8.2.5" data-path="dalex.html"><a href="dalex.html#interpretability-dataset-level"><i class="fa fa-check"></i><b>8.2.5</b> Dataset level exploration</a></li>
<li class="chapter" data-level="8.2.6" data-path="dalex.html"><a href="dalex.html#interpretability-instance-level"><i class="fa fa-check"></i><b>8.2.6</b> Instance level explanation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>9</b> Appendix</a>
<ul>
<li class="chapter" data-level="9.1" data-path="list-learners.html"><a href="list-learners.html"><i class="fa fa-check"></i><b>9.1</b> Integrated Learners</a></li>
<li class="chapter" data-level="9.2" data-path="list-measures.html"><a href="list-measures.html"><i class="fa fa-check"></i><b>9.2</b> Integrated Performance Measures</a></li>
<li class="chapter" data-level="9.3" data-path="list-filters.html"><a href="list-filters.html"><i class="fa fa-check"></i><b>9.3</b> Integrated Filter Methods</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="list-filters.html"><a href="list-filters.html#fs-filter-list"><i class="fa fa-check"></i><b>9.3.1</b> Standalone filter methods</a></li>
<li class="chapter" data-level="9.3.2" data-path="list-filters.html"><a href="list-filters.html#fs-filter-embedded-list"><i class="fa fa-check"></i><b>9.3.2</b> Learners With Embedded Filter Methods</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="list-pipeops.html"><a href="list-pipeops.html"><i class="fa fa-check"></i><b>9.4</b> Integrated Pipe Operators</a></li>
<li class="chapter" data-level="9.5" data-path="compare-frameworks.html"><a href="compare-frameworks.html"><i class="fa fa-check"></i><b>9.5</b> Framework Comparison</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="compare-frameworks.html"><a href="compare-frameworks.html#an-introduction-to-pipeops"><i class="fa fa-check"></i><b>9.5.1</b> An introduction to “PipeOp”s</a>
<ul>
<li class="chapter" data-level="9.5.1.1" data-path="compare-frameworks.html"><a href="compare-frameworks.html#a-quick-glance-into-a-pipeop"><i class="fa fa-check"></i><b>9.5.1.1</b> A quick glance into a PipeOp</a></li>
<li class="chapter" data-level="9.5.1.2" data-path="compare-frameworks.html"><a href="compare-frameworks.html#constructing-the-pipeline"><i class="fa fa-check"></i><b>9.5.1.2</b> Constructing the Pipeline</a></li>
</ul></li>
<li class="chapter" data-level="9.5.2" data-path="compare-frameworks.html"><a href="compare-frameworks.html#mlr3pipelines-vs.-mlr"><i class="fa fa-check"></i><b>9.5.2</b> mlr3pipelines vs. mlr</a>
<ul>
<li class="chapter" data-level="9.5.2.1" data-path="compare-frameworks.html"><a href="compare-frameworks.html#mlr"><i class="fa fa-check"></i><b>9.5.2.1</b> mlr</a></li>
<li class="chapter" data-level="9.5.2.2" data-path="compare-frameworks.html"><a href="compare-frameworks.html#mlr3pipelines"><i class="fa fa-check"></i><b>9.5.2.2</b> mlr3pipelines</a></li>
</ul></li>
<li class="chapter" data-level="9.5.3" data-path="compare-frameworks.html"><a href="compare-frameworks.html#mlr3pipelines-vs.-sklearn.pipeline.pipeline"><i class="fa fa-check"></i><b>9.5.3</b> mlr3pipelines vs. sklearn.pipeline.Pipeline</a>
<ul>
<li class="chapter" data-level="9.5.3.1" data-path="compare-frameworks.html"><a href="compare-frameworks.html#sklearn"><i class="fa fa-check"></i><b>9.5.3.1</b> sklearn</a></li>
<li class="chapter" data-level="9.5.3.2" data-path="compare-frameworks.html"><a href="compare-frameworks.html#mlr3pipelines-1"><i class="fa fa-check"></i><b>9.5.3.2</b> mlr3pipelines</a></li>
</ul></li>
<li class="chapter" data-level="9.5.4" data-path="compare-frameworks.html"><a href="compare-frameworks.html#mlr3pipelines-vs-recipes"><i class="fa fa-check"></i><b>9.5.4</b> mlr3pipelines vs recipes</a>
<ul>
<li class="chapter" data-level="9.5.4.1" data-path="compare-frameworks.html"><a href="compare-frameworks.html#recipes"><i class="fa fa-check"></i><b>9.5.4.1</b> recipes</a></li>
<li class="chapter" data-level="9.5.4.2" data-path="compare-frameworks.html"><a href="compare-frameworks.html#mlr3pipelines-2"><i class="fa fa-check"></i><b>9.5.4.2</b> mlr3pipelines</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">mlr3 book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="extending-pipeops" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Adding new PipeOps</h2>
<p>This section showcases how the <code>mlr3pipelines</code> package can be extended to include custom <code>PipeOp</code>s.
To run the following examples, we will need a <code>Task</code>; we are using the well-known “Iris” task:</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="extending-pipeops.html#cb675-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;mlr3&quot;</span>)</span>
<span id="cb675-2"><a href="extending-pipeops.html#cb675-2" aria-hidden="true" tabindex="-1"></a>task <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">&quot;iris&quot;</span>)</span>
<span id="cb675-3"><a href="extending-pipeops.html#cb675-3" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span><span class="fu">data</span>()</span></code></pre></div>
<pre><code>##        Species Petal.Length Petal.Width Sepal.Length Sepal.Width
##   1:    setosa          1.4         0.2          5.1         3.5
##   2:    setosa          1.4         0.2          4.9         3.0
##   3:    setosa          1.3         0.2          4.7         3.2
##   4:    setosa          1.5         0.2          4.6         3.1
##   5:    setosa          1.4         0.2          5.0         3.6
##  ---                                                            
## 146: virginica          5.2         2.3          6.7         3.0
## 147: virginica          5.0         1.9          6.3         2.5
## 148: virginica          5.2         2.0          6.5         3.0
## 149: virginica          5.4         2.3          6.2         3.4
## 150: virginica          5.1         1.8          5.9         3.0</code></pre>
<p><code>mlr3pipelines</code> is fundamentally built around <a href="https://r6.r-lib.org/"><code>R6</code></a>. When planning to create custom <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a> objects, it can only help to <a href="https://adv-r.hadley.nz/r6.html">familiarize yourself with it</a>.</p>
<p>In principle, all a <code>PipeOp</code> must do is inherit from the <code>PipeOp</code> R6 class and implement the <code>.train()</code> and <code>.predict()</code> functions.
There are, however, several auxiliary subclasses that can make the creation of <em>certain</em> operations much easier.</p>
<div id="ext-pipeopcopy" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> General Case Example: <code>PipeOpCopy</code></h3>
<p>A very simple yet useful <code>PipeOp</code> is <code>PipeOpCopy</code>, which takes a single input and creates a variable number of output channels, all of which receive a copy of the input data.
It is a simple example that showcases the important steps in defining a custom <code>PipeOp</code>.
We will show a simplified version here, <strong><code>PipeOpCopyTwo</code></strong>, that creates exactly two copies of its input data.</p>
<p>The following figure visualizes how our <code>PipeOp</code> is situated in the <code>Pipeline</code> and the significant in- and outputs.</p>
<p><img src="images/po_multi_viz.png" width="430" style="display: block; margin: auto;" /></p>
<div id="first-steps-inheriting-from-pipeop" class="section level4" number="6.3.1.1">
<h4><span class="header-section-number">6.3.1.1</span> First Steps: Inheriting from <code>PipeOp</code></h4>
<p>The first part of creating a custom <code>PipeOp</code> is inheriting from <code>PipeOp</code>.
We make a mental note that we need to implement a <code>.train()</code> and a <code>.predict()</code> function, and that we probably want to have an <code>initialize()</code> as well:</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="extending-pipeops.html#cb677-1" aria-hidden="true" tabindex="-1"></a>PipeOpCopyTwo <span class="ot">=</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(<span class="st">&quot;PipeOpCopyTwo&quot;</span>,</span>
<span id="cb677-2"><a href="extending-pipeops.html#cb677-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> mlr3pipelines<span class="sc">::</span>PipeOp,</span>
<span id="cb677-3"><a href="extending-pipeops.html#cb677-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb677-4"><a href="extending-pipeops.html#cb677-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="st">&quot;copy.two&quot;</span>) {</span>
<span id="cb677-5"><a href="extending-pipeops.html#cb677-5" aria-hidden="true" tabindex="-1"></a>      ....</span>
<span id="cb677-6"><a href="extending-pipeops.html#cb677-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb677-7"><a href="extending-pipeops.html#cb677-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb677-8"><a href="extending-pipeops.html#cb677-8" aria-hidden="true" tabindex="-1"></a>  private <span class="sc">==</span> <span class="fu">list</span>(</span>
<span id="cb677-9"><a href="extending-pipeops.html#cb677-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.train =</span> <span class="cf">function</span>(inputs) {</span>
<span id="cb677-10"><a href="extending-pipeops.html#cb677-10" aria-hidden="true" tabindex="-1"></a>      ....</span>
<span id="cb677-11"><a href="extending-pipeops.html#cb677-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb677-12"><a href="extending-pipeops.html#cb677-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-13"><a href="extending-pipeops.html#cb677-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.predict =</span> <span class="cf">function</span>(inputs) {</span>
<span id="cb677-14"><a href="extending-pipeops.html#cb677-14" aria-hidden="true" tabindex="-1"></a>      ....</span>
<span id="cb677-15"><a href="extending-pipeops.html#cb677-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb677-16"><a href="extending-pipeops.html#cb677-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb677-17"><a href="extending-pipeops.html#cb677-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Note, that <strong>private</strong> methods, e.g. <code>.train</code> and <code>.predict</code> etc are prefixed with a <code>.</code>.</p>
</div>
<div id="channel-definitions" class="section level4" number="6.3.1.2">
<h4><span class="header-section-number">6.3.1.2</span> Channel Definitions</h4>
<p>We need to tell the <code>PipeOp</code> the layout of its channels: How many there are, what their names are going to be, and what types are acceptable.
This is done on initialization of the <code>PipeOp</code> (using a <code>super$initialize</code> call) by giving the <code>input</code> and <code>output</code> <code>data.table</code> objects.
These must have three columns: a <code>"name"</code> column giving the names of input and output channels, and a <code>"train"</code> and <code>"predict"</code> column naming the class of objects we expect during training and prediction as input / output.
A special value for these classes is <code>"*"</code>, which indicates that any class will be accepted; our simple copy operator accepts any kind of input, so this will be useful. We have only one input, but two output channels.</p>
<p>By convention, we name a single channel <code>"input"</code> or <code>"output"</code>, and a group of channels [<code>"input1"</code>, <code>"input2"</code>, …], unless there is a reason to give specific different names. Therefore, our <code>input</code> <code>data.table</code> will have a single row <code>&lt;"input", "*", "*"&gt;</code>, and our <code>output</code> table will have two rows, <code>&lt;"output1", "*", "*"&gt;</code> and <code>&lt;"output2", "*", "*"&gt;</code>.</p>
<p>All of this is given to the <code>PipeOp</code> creator. Our <code>initialize()</code> will thus look as follows:</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="extending-pipeops.html#cb678-1" aria-hidden="true" tabindex="-1"></a>    initialize <span class="ot">=</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="st">&quot;copy.two&quot;</span>) {</span>
<span id="cb678-2"><a href="extending-pipeops.html#cb678-2" aria-hidden="true" tabindex="-1"></a>      input <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">name =</span> <span class="st">&quot;input&quot;</span>, <span class="at">train =</span> <span class="st">&quot;*&quot;</span>, <span class="at">predict =</span> <span class="st">&quot;*&quot;</span>)</span>
<span id="cb678-3"><a href="extending-pipeops.html#cb678-3" aria-hidden="true" tabindex="-1"></a>      <span class="co"># the following will create two rows and automatically fill the `train`</span></span>
<span id="cb678-4"><a href="extending-pipeops.html#cb678-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and `predict` cols with &quot;*&quot;</span></span>
<span id="cb678-5"><a href="extending-pipeops.html#cb678-5" aria-hidden="true" tabindex="-1"></a>      output <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb678-6"><a href="extending-pipeops.html#cb678-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;output1&quot;</span>, <span class="st">&quot;output2&quot;</span>),</span>
<span id="cb678-7"><a href="extending-pipeops.html#cb678-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">train =</span> <span class="st">&quot;*&quot;</span>, <span class="at">predict =</span> <span class="st">&quot;*&quot;</span></span>
<span id="cb678-8"><a href="extending-pipeops.html#cb678-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb678-9"><a href="extending-pipeops.html#cb678-9" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">initialize</span>(id,</span>
<span id="cb678-10"><a href="extending-pipeops.html#cb678-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">input =</span> input,</span>
<span id="cb678-11"><a href="extending-pipeops.html#cb678-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">output =</span> output</span>
<span id="cb678-12"><a href="extending-pipeops.html#cb678-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb678-13"><a href="extending-pipeops.html#cb678-13" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
</div>
<div id="train-and-predict" class="section level4" number="6.3.1.3">
<h4><span class="header-section-number">6.3.1.3</span> Train and Predict</h4>
<p>Both <code>.train()</code> and <code>.predict()</code> will receive a <code>list</code> as input and must give a <code>list</code> in return.
According to our <code>input</code> and <code>output</code> definitions, we will always get a list with a single element as input, and will need to return a list with two elements. Because all we want to do is create two copies, we will just create the copies using <code>c(inputs, inputs)</code>.</p>
<p>Two things to consider:</p>
<ul>
<li><p>The <code>.train()</code> function must always modify the <code>self$state</code> variable to something that is not <code>NULL</code> or <code>NO_OP</code>.
This is because the <code>$state</code> slot is used as a signal that <code>PipeOp</code> has been trained on data, even if the state itself is not important to the <code>PipeOp</code> (as in our case).
Therefore, our <code>.train()</code> will set <code>self$state = list()</code>.</p></li>
<li><p>It is not necessary to “clone” our input or make deep copies, because we don’t modify the data.
However, if we were changing a reference-passed object, for example by changing data in a <code>Task</code>, we would have to make a deep copy first.
This is because a <code>PipeOp</code> may never modify its input object by reference.</p></li>
</ul>
<p>Our <code>.train()</code> and <code>.predict()</code> functions are now:</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="extending-pipeops.html#cb679-1" aria-hidden="true" tabindex="-1"></a>.train <span class="ot">=</span> <span class="cf">function</span>(inputs) {</span>
<span id="cb679-2"><a href="extending-pipeops.html#cb679-2" aria-hidden="true" tabindex="-1"></a>  self<span class="sc">$</span>state <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb679-3"><a href="extending-pipeops.html#cb679-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(inputs, inputs)</span>
<span id="cb679-4"><a href="extending-pipeops.html#cb679-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="extending-pipeops.html#cb680-1" aria-hidden="true" tabindex="-1"></a>.predict <span class="ot">=</span> <span class="cf">function</span>(inputs) {</span>
<span id="cb680-2"><a href="extending-pipeops.html#cb680-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(inputs, inputs)</span>
<span id="cb680-3"><a href="extending-pipeops.html#cb680-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="putting-it-together" class="section level4" number="6.3.1.4">
<h4><span class="header-section-number">6.3.1.4</span> Putting it Together</h4>
<p>The whole definition thus becomes</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="extending-pipeops.html#cb681-1" aria-hidden="true" tabindex="-1"></a>PipeOpCopyTwo <span class="ot">=</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(<span class="st">&quot;PipeOpCopyTwo&quot;</span>,</span>
<span id="cb681-2"><a href="extending-pipeops.html#cb681-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> mlr3pipelines<span class="sc">::</span>PipeOp,</span>
<span id="cb681-3"><a href="extending-pipeops.html#cb681-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb681-4"><a href="extending-pipeops.html#cb681-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="st">&quot;copy.two&quot;</span>) {</span>
<span id="cb681-5"><a href="extending-pipeops.html#cb681-5" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">initialize</span>(id,</span>
<span id="cb681-6"><a href="extending-pipeops.html#cb681-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">input =</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">name =</span> <span class="st">&quot;input&quot;</span>, <span class="at">train =</span> <span class="st">&quot;*&quot;</span>, <span class="at">predict =</span> <span class="st">&quot;*&quot;</span>),</span>
<span id="cb681-7"><a href="extending-pipeops.html#cb681-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">output =</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;output1&quot;</span>, <span class="st">&quot;output2&quot;</span>),</span>
<span id="cb681-8"><a href="extending-pipeops.html#cb681-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">train =</span> <span class="st">&quot;*&quot;</span>, <span class="at">predict =</span> <span class="st">&quot;*&quot;</span>)</span>
<span id="cb681-9"><a href="extending-pipeops.html#cb681-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb681-10"><a href="extending-pipeops.html#cb681-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb681-11"><a href="extending-pipeops.html#cb681-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb681-12"><a href="extending-pipeops.html#cb681-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb681-13"><a href="extending-pipeops.html#cb681-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.train =</span> <span class="cf">function</span>(inputs) {</span>
<span id="cb681-14"><a href="extending-pipeops.html#cb681-14" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>state <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb681-15"><a href="extending-pipeops.html#cb681-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(inputs, inputs)</span>
<span id="cb681-16"><a href="extending-pipeops.html#cb681-16" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb681-17"><a href="extending-pipeops.html#cb681-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb681-18"><a href="extending-pipeops.html#cb681-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.predict =</span> <span class="cf">function</span>(inputs) {</span>
<span id="cb681-19"><a href="extending-pipeops.html#cb681-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(inputs, inputs)</span>
<span id="cb681-20"><a href="extending-pipeops.html#cb681-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb681-21"><a href="extending-pipeops.html#cb681-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb681-22"><a href="extending-pipeops.html#cb681-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We can create an instance of our <code>PipeOp</code>, put it in a graph, and see what happens when we train it on something:</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="extending-pipeops.html#cb682-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;mlr3pipelines&quot;</span>)</span>
<span id="cb682-2"><a href="extending-pipeops.html#cb682-2" aria-hidden="true" tabindex="-1"></a>poct <span class="ot">=</span> PipeOpCopyTwo<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb682-3"><a href="extending-pipeops.html#cb682-3" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> Graph<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb682-4"><a href="extending-pipeops.html#cb682-4" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span><span class="fu">add_pipeop</span>(poct)</span>
<span id="cb682-5"><a href="extending-pipeops.html#cb682-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb682-6"><a href="extending-pipeops.html#cb682-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gr)</span></code></pre></div>
<pre><code>## Graph with 1 PipeOps:
##        ID         State sccssors prdcssors
##  copy.two &lt;&lt;UNTRAINED&gt;&gt;</code></pre>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="extending-pipeops.html#cb684-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">train</span>(task)</span>
<span id="cb684-2"><a href="extending-pipeops.html#cb684-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-3"><a href="extending-pipeops.html#cb684-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(result)</span></code></pre></div>
<pre><code>## List of 2
##  $ copy.two.output1:Classes &#39;TaskClassif&#39;, &#39;TaskSupervised&#39;, &#39;Task&#39;, &#39;R6&#39; &lt;TaskClassif:iris&gt; 
##  $ copy.two.output2:Classes &#39;TaskClassif&#39;, &#39;TaskSupervised&#39;, &#39;Task&#39;, &#39;R6&#39; &lt;TaskClassif:iris&gt;</code></pre>
</div>
</div>
<div id="ext-pipe-preproc" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Special Case: Preprocessing</h3>
<p>Many <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a>s perform an operation on exactly one <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a>, and return exactly one <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a>. They may even not care about the “Target” / “Outcome” variable of that task, and only do some modification of some input data.
However, it is usually important to them that the <code>Task</code> on which they perform prediction has the same data columns as the <code>Task</code> on which they train.
For these cases, the auxiliary base class <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html"><code>PipeOpTaskPreproc</code></a> exists.
It inherits from <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a> itself, and other <code>PipeOp</code>s should use it if they fall in the kind of use-case named above.</p>
<p>When inheriting from <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html"><code>PipeOpTaskPreproc</code></a>, one must either implement the private methods <code>.train_task()</code> and <code>.predict_task()</code>, or the methods <code>.train_dt()</code>, <code>.predict_dt()</code>, depending on whether wants to operate on a <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> object or on its data as <code>data.table</code>s.
In the second case, one can optionally also overload the <code>.select_cols()</code> method, which chooses which of the incoming <code>Task</code>’s features are given to the <code>.train_dt()</code> / <code>.predict_dt()</code> functions.</p>
<p>The following will show two examples: <code>PipeOpDropNA</code>, which removes a <code>Task</code>’s rows with missing values during training (and implements <code>.train_task()</code> and <code>.predict_task()</code>), and <code>PipeOpScale</code>, which scales a <code>Task</code>’s numeric columns (and implements <code>.train_dt()</code>, <code>.predict_dt()</code>, and <code>.select_cols()</code>).</p>
<div id="example-pipeopdropna" class="section level4" number="6.3.2.1">
<h4><span class="header-section-number">6.3.2.1</span> Example: <code>PipeOpDropNA</code></h4>
<p>Dropping rows with missing values may be important when training a model that can not handle them.</p>
<p>Because <code>mlr3</code> <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Tasks</code></a> only contain a view to the underlying data, it is not necessary to modify data to remove rows with missing values.
Instead, the rows can be removed using the <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a>’s <code>$filter</code> method, which modifies the <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> in-place.
This is done in the private method <code>.train_task()</code>.
We take care that we also set the <code>$state</code> slot to signal that the <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a> was trained.</p>
<p>The private method <code>.predict_task()</code> does not need to do anything; removing missing values during prediction is not as useful, since learners that cannot handle them will just ignore the respective rows.
Furthermore, <code>mlr3</code> expects a <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a> to always return just as many predictions as it was given input rows, so a <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a> that removes <code>Task</code> rows during training can not be used inside a <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html"><code>GraphLearner</code></a>.</p>
<p>When we inherit from <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html"><code>PipeOpTaskPreproc</code></a>, it sets the <code>input</code> and <code>output</code> <code>data.table</code>s for us to only accept a single <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a>.
The only thing we do during <code>initialize()</code> is therefore to set an <code>id</code> (which can optionally be changed by the user).</p>
<p>The complete <code>PipeOpDropNA</code> can therefore be written as follows.
Note that it inherits from <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html"><code>PipeOpTaskPreproc</code></a>, unlike the <code>PipeOpCopyTwo</code> example from above:</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="extending-pipeops.html#cb686-1" aria-hidden="true" tabindex="-1"></a>PipeOpDropNA <span class="ot">=</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(<span class="st">&quot;PipeOpDropNA&quot;</span>,</span>
<span id="cb686-2"><a href="extending-pipeops.html#cb686-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> mlr3pipelines<span class="sc">::</span>PipeOpTaskPreproc,</span>
<span id="cb686-3"><a href="extending-pipeops.html#cb686-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb686-4"><a href="extending-pipeops.html#cb686-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="st">&quot;drop.na&quot;</span>) {</span>
<span id="cb686-5"><a href="extending-pipeops.html#cb686-5" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">initialize</span>(id)</span>
<span id="cb686-6"><a href="extending-pipeops.html#cb686-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb686-7"><a href="extending-pipeops.html#cb686-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb686-8"><a href="extending-pipeops.html#cb686-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-9"><a href="extending-pipeops.html#cb686-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb686-10"><a href="extending-pipeops.html#cb686-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.train_task =</span> <span class="cf">function</span>(task) {</span>
<span id="cb686-11"><a href="extending-pipeops.html#cb686-11" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>state <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb686-12"><a href="extending-pipeops.html#cb686-12" aria-hidden="true" tabindex="-1"></a>      featuredata <span class="ot">=</span> task<span class="sc">$</span><span class="fu">data</span>(<span class="at">cols =</span> task<span class="sc">$</span>feature_names)</span>
<span id="cb686-13"><a href="extending-pipeops.html#cb686-13" aria-hidden="true" tabindex="-1"></a>      exclude <span class="ot">=</span> <span class="fu">apply</span>(<span class="fu">is.na</span>(featuredata), <span class="dv">1</span>, any)</span>
<span id="cb686-14"><a href="extending-pipeops.html#cb686-14" aria-hidden="true" tabindex="-1"></a>      task<span class="sc">$</span><span class="fu">filter</span>(task<span class="sc">$</span>row_ids[<span class="sc">!</span>exclude])</span>
<span id="cb686-15"><a href="extending-pipeops.html#cb686-15" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb686-16"><a href="extending-pipeops.html#cb686-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-17"><a href="extending-pipeops.html#cb686-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.predict_task =</span> <span class="cf">function</span>(task) {</span>
<span id="cb686-18"><a href="extending-pipeops.html#cb686-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># nothing to be done</span></span>
<span id="cb686-19"><a href="extending-pipeops.html#cb686-19" aria-hidden="true" tabindex="-1"></a>      task</span>
<span id="cb686-20"><a href="extending-pipeops.html#cb686-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb686-21"><a href="extending-pipeops.html#cb686-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb686-22"><a href="extending-pipeops.html#cb686-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>To test this <code>PipeOp</code>, we create a small task with missing values:</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="extending-pipeops.html#cb687-1" aria-hidden="true" tabindex="-1"></a>smalliris <span class="ot">=</span> iris[(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">30</span>, ]</span>
<span id="cb687-2"><a href="extending-pipeops.html#cb687-2" aria-hidden="true" tabindex="-1"></a>smalliris[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb687-3"><a href="extending-pipeops.html#cb687-3" aria-hidden="true" tabindex="-1"></a>smalliris[<span class="dv">2</span>, <span class="dv">2</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb687-4"><a href="extending-pipeops.html#cb687-4" aria-hidden="true" tabindex="-1"></a>sitask <span class="ot">=</span> <span class="fu">as_task_classif</span>(smalliris, <span class="at">target =</span> <span class="st">&quot;Species&quot;</span>)</span>
<span id="cb687-5"><a href="extending-pipeops.html#cb687-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sitask<span class="sc">$</span><span class="fu">data</span>())</span></code></pre></div>
<pre><code>##       Species Petal.Length Petal.Width Sepal.Length Sepal.Width
## 1:     setosa          1.6         0.2           NA         3.2
## 2: versicolor          3.9         1.4          5.2          NA
## 3: versicolor          4.0         1.3          5.5         2.5
## 4:  virginica          5.0         1.5          6.0         2.2
## 5:  virginica          5.1         1.8          5.9         3.0</code></pre>
<p>We test this by feeding it to a new <code>Graph</code> that uses <code>PipeOpDropNA</code>.</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="extending-pipeops.html#cb689-1" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> Graph<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb689-2"><a href="extending-pipeops.html#cb689-2" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span><span class="fu">add_pipeop</span>(PipeOpDropNA<span class="sc">$</span><span class="fu">new</span>())</span>
<span id="cb689-3"><a href="extending-pipeops.html#cb689-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb689-4"><a href="extending-pipeops.html#cb689-4" aria-hidden="true" tabindex="-1"></a>filtered_task <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">train</span>(sitask)[[<span class="dv">1</span>]]</span>
<span id="cb689-5"><a href="extending-pipeops.html#cb689-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(filtered_task<span class="sc">$</span><span class="fu">data</span>())</span></code></pre></div>
<pre><code>##       Species Petal.Length Petal.Width Sepal.Length Sepal.Width
## 1: versicolor          4.0         1.3          5.5         2.5
## 2:  virginica          5.0         1.5          6.0         2.2
## 3:  virginica          5.1         1.8          5.9         3.0</code></pre>
</div>
<div id="example-pipeopscalealways" class="section level4" number="6.3.2.2">
<h4><span class="header-section-number">6.3.2.2</span> Example: <code>PipeOpScaleAlways</code></h4>
<p>An often-applied preprocessing step is to simply <strong>center</strong> and/or <strong>scale</strong> the data to mean <span class="math inline">\(0\)</span> and standard deviation <span class="math inline">\(1\)</span>.
This fits the <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html"><code>PipeOpTaskPreproc</code></a> pattern quite well.
Because it always replaces all columns that it operates on, and does not require any information about the task’s target, it only needs to overload the <code>.train_dt()</code> and <code>.predict_dt()</code> functions.
This saves some boilerplate-code from getting the correct feature columns out of the task, and replacing them after modification.</p>
<p>Because scaling only makes sense on numeric features, we want to instruct <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html"><code>PipeOpTaskPreproc</code></a> to give us only these numeric columns.
We do this by overloading the <code>.select_cols()</code> function: It is called by the class to determine which columns to pass to <code>.train_dt()</code> and <code>.predict_dt()</code>.
Its input is the <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> that is being transformed, and it should return a <code>character</code> vector of all features to work with.
When it is not overloaded, it uses all columns; instead, we will set it to only give us numeric columns.
Because the <code>levels()</code> of the data table given to <code>.train_dt()</code> and <code>.predict_dt()</code> may be different from the <code>task</code>’s levels, these functions must also take a <code>levels</code> argument that is a named list of column names indicating their levels.
When working with numeric data, this argument can be ignored, but it should be used instead of <code>levels(dt[[column]])</code> for factorial or character columns.</p>
<p>This is the first <code>PipeOp</code> where we will be using the <code>$state</code> slot for something useful: We save the centering offset and scaling coefficient and use it in <code>$.predict()</code>!</p>
<p>For simplicity, we are not using hyperparameters and will always scale and center all data.
Compare this <code>PipeOpScaleAlways</code> operator to the one defined inside the <code>mlr3pipelines</code> package, <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_scale.html"><code>PipeOpScale</code></a>.</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="extending-pipeops.html#cb691-1" aria-hidden="true" tabindex="-1"></a>PipeOpScaleAlways <span class="ot">=</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(<span class="st">&quot;PipeOpScaleAlways&quot;</span>,</span>
<span id="cb691-2"><a href="extending-pipeops.html#cb691-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> mlr3pipelines<span class="sc">::</span>PipeOpTaskPreproc,</span>
<span id="cb691-3"><a href="extending-pipeops.html#cb691-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb691-4"><a href="extending-pipeops.html#cb691-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="st">&quot;scale.always&quot;</span>) {</span>
<span id="cb691-5"><a href="extending-pipeops.html#cb691-5" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">initialize</span>(<span class="at">id =</span> id)</span>
<span id="cb691-6"><a href="extending-pipeops.html#cb691-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb691-7"><a href="extending-pipeops.html#cb691-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb691-8"><a href="extending-pipeops.html#cb691-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-9"><a href="extending-pipeops.html#cb691-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb691-10"><a href="extending-pipeops.html#cb691-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.select_cols =</span> <span class="cf">function</span>(task) {</span>
<span id="cb691-11"><a href="extending-pipeops.html#cb691-11" aria-hidden="true" tabindex="-1"></a>      task<span class="sc">$</span>feature_types[type <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>, id]</span>
<span id="cb691-12"><a href="extending-pipeops.html#cb691-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb691-13"><a href="extending-pipeops.html#cb691-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-14"><a href="extending-pipeops.html#cb691-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.train_dt =</span> <span class="cf">function</span>(dt, levels, target) {</span>
<span id="cb691-15"><a href="extending-pipeops.html#cb691-15" aria-hidden="true" tabindex="-1"></a>      sc <span class="ot">=</span> <span class="fu">scale</span>(<span class="fu">as.matrix</span>(dt))</span>
<span id="cb691-16"><a href="extending-pipeops.html#cb691-16" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>state <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb691-17"><a href="extending-pipeops.html#cb691-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">center =</span> <span class="fu">attr</span>(sc, <span class="st">&quot;scaled:center&quot;</span>),</span>
<span id="cb691-18"><a href="extending-pipeops.html#cb691-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="fu">attr</span>(sc, <span class="st">&quot;scaled:scale&quot;</span>)</span>
<span id="cb691-19"><a href="extending-pipeops.html#cb691-19" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb691-20"><a href="extending-pipeops.html#cb691-20" aria-hidden="true" tabindex="-1"></a>      sc</span>
<span id="cb691-21"><a href="extending-pipeops.html#cb691-21" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb691-22"><a href="extending-pipeops.html#cb691-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-23"><a href="extending-pipeops.html#cb691-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">.predict_dt =</span> <span class="cf">function</span>(dt, levels) {</span>
<span id="cb691-24"><a href="extending-pipeops.html#cb691-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>((<span class="fu">t</span>(dt) <span class="sc">-</span> self<span class="sc">$</span>state<span class="sc">$</span>center) <span class="sc">/</span> self<span class="sc">$</span>state<span class="sc">$</span>scale)</span>
<span id="cb691-25"><a href="extending-pipeops.html#cb691-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb691-26"><a href="extending-pipeops.html#cb691-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb691-27"><a href="extending-pipeops.html#cb691-27" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><em>(Note for the observant: If you check <code>PipeOpScale.R</code> from the <code>mlr3pipelines</code> package, you will notice that is uses “<code>get("type")</code>” and “<code>get("id")</code>” instead of “<code>type</code>” and “<code>id</code>,” because the static code checker on CRAN would otherwise complain about references to undefined variables. This is a “problem” with <code>data.table</code> and not exclusive to <code>mlr3pipelines</code>.)</em></p>
<p>We can, again, create a new <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> that uses this <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a> to test it.
Compare the resulting data to the original “iris” <code>Task</code> data printed at the beginning:</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="extending-pipeops.html#cb692-1" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> Graph<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb692-2"><a href="extending-pipeops.html#cb692-2" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span><span class="fu">add_pipeop</span>(PipeOpScaleAlways<span class="sc">$</span><span class="fu">new</span>())</span>
<span id="cb692-3"><a href="extending-pipeops.html#cb692-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-4"><a href="extending-pipeops.html#cb692-4" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">train</span>(task)</span>
<span id="cb692-5"><a href="extending-pipeops.html#cb692-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-6"><a href="extending-pipeops.html#cb692-6" aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">data</span>()</span></code></pre></div>
<pre><code>##        Species Petal.Length Petal.Width Sepal.Length Sepal.Width
##   1:    setosa      -1.3358     -1.3111     -0.89767     1.01560
##   2:    setosa      -1.3358     -1.3111     -1.13920    -0.13154
##   3:    setosa      -1.3924     -1.3111     -1.38073     0.32732
##   4:    setosa      -1.2791     -1.3111     -1.50149     0.09789
##   5:    setosa      -1.3358     -1.3111     -1.01844     1.24503
##  ---                                                            
## 146: virginica       0.8169      1.4440      1.03454    -0.13154
## 147: virginica       0.7036      0.9192      0.55149    -1.27868
## 148: virginica       0.8169      1.0504      0.79301    -0.13154
## 149: virginica       0.9302      1.4440      0.43072     0.78617
## 150: virginica       0.7602      0.7880      0.06843    -0.13154</code></pre>
</div>
</div>
<div id="special-case-preprocessing-with-simple-train" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Special Case: Preprocessing with Simple Train</h3>
<p>It is possible to make even further simplifications for many <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a>s that perform mostly the same operation during training and prediction.
The point of <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> preprocessing is often to modify the training data in mostly the same way as prediction data (but in a way that <em>may</em> depend on training data).</p>
<p>Consider constant feature removal, for example: The goal is to remove features that have no variance, or only a single factor level.
However, what features get removed must be decided during <em>training</em>, and may only depend on training data.
Furthermore, the actual process of removing features is the same during training and prediction.</p>
<p>A simplification to make is therefore to have a private method <code>.get_state(task)</code> which sets the <code>$state</code> slot during training, and a private method <code>.transform(task)</code>, which gets called both during training <em>and</em> prediction.
This is done in the <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreprocSimple.html"><code>PipeOpTaskPreprocSimple</code></a> class.
Just like <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html"><code>PipeOpTaskPreproc</code></a>, one can inherit from this and overload these functions to get a <code>PipeOp</code> that performs preprocessing with very little boilerplate code.</p>
<p>Just like <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreproc.html"><code>PipeOpTaskPreproc</code></a>, <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreprocSimple.html"><code>PipeOpTaskPreprocSimple</code></a> offers the possibility to instead overload the <code>.get_state_dt(dt, levels)</code> and <code>.transform_dt(dt, levels)</code> methods (and optionally, again, the <code>.select_cols(task)</code> function) to operate on <code>data.table</code> feature data instead of the whole <code>Task</code>.</p>
<p>Even some methods that do not use <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpTaskPreprocSimple.html"><code>PipeOpTaskPreprocSimple</code></a> <em>could</em> work in a similar way: The <code>PipeOpScaleAlways</code> example from above will be shown to also work with this paradigm.</p>
<div id="example-pipeopdropconst" class="section level4" number="6.3.3.1">
<h4><span class="header-section-number">6.3.3.1</span> Example: <code>PipeOpDropConst</code></h4>
<p>A typical example of a preprocessing operation that does almost the same operation during training and prediction is an operation that drops features depending on a criterion that is evaluated during training.
One simple example of this is dropping constant features.
Because the <code>mlr3</code> <code>Task</code> class offers a flexible view on underlying data, it is most efficient to drop columns from the task directly using its <code>$select()</code> function, so the <code>.get_state_dt(dt, levels)</code> / <code>.transform_dt(dt, levels)</code> functions will <em>not</em> get used; instead we overload the <code>.get_state(task)</code> and <code>.transform(task)</code> methods.</p>
<p>The <code>.get_state()</code> function’s result is saved to the <code>$state</code> slot, so we want to return something that is useful for dropping features.
We choose to save the names of all the columns that have nonzero variance.
For brevity, we use <code>length(unique(column)) &gt; 1</code> to check whether more than one distinct value is present; a more sophisticated version could have a tolerance parameter for numeric values that are very close to each other.</p>
<p>The <code>.transform()</code> method is evaluated both during training <em>and</em> prediction, and can rely on the <code>$state</code> slot being present.
All it does here is call the <code>Task$select</code> function with the columns we chose to keep.</p>
<p>The full <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a> could be written as follows:</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="extending-pipeops.html#cb694-1" aria-hidden="true" tabindex="-1"></a>PipeOpDropConst <span class="ot">=</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(<span class="st">&quot;PipeOpDropConst&quot;</span>,</span>
<span id="cb694-2"><a href="extending-pipeops.html#cb694-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> mlr3pipelines<span class="sc">::</span>PipeOpTaskPreprocSimple,</span>
<span id="cb694-3"><a href="extending-pipeops.html#cb694-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb694-4"><a href="extending-pipeops.html#cb694-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="st">&quot;drop.const&quot;</span>) {</span>
<span id="cb694-5"><a href="extending-pipeops.html#cb694-5" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">initialize</span>(<span class="at">id =</span> id)</span>
<span id="cb694-6"><a href="extending-pipeops.html#cb694-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb694-7"><a href="extending-pipeops.html#cb694-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb694-8"><a href="extending-pipeops.html#cb694-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-9"><a href="extending-pipeops.html#cb694-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb694-10"><a href="extending-pipeops.html#cb694-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.get_state =</span> <span class="cf">function</span>(task) {</span>
<span id="cb694-11"><a href="extending-pipeops.html#cb694-11" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">=</span> task<span class="sc">$</span><span class="fu">data</span>(<span class="at">cols =</span> task<span class="sc">$</span>feature_names)</span>
<span id="cb694-12"><a href="extending-pipeops.html#cb694-12" aria-hidden="true" tabindex="-1"></a>      nonconst <span class="ot">=</span> <span class="fu">sapply</span>(data, <span class="cf">function</span>(column) <span class="fu">length</span>(<span class="fu">unique</span>(column)) <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb694-13"><a href="extending-pipeops.html#cb694-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">cnames =</span> <span class="fu">colnames</span>(data)[nonconst])</span>
<span id="cb694-14"><a href="extending-pipeops.html#cb694-14" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb694-15"><a href="extending-pipeops.html#cb694-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-16"><a href="extending-pipeops.html#cb694-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.transform =</span> <span class="cf">function</span>(task) {</span>
<span id="cb694-17"><a href="extending-pipeops.html#cb694-17" aria-hidden="true" tabindex="-1"></a>      task<span class="sc">$</span><span class="fu">select</span>(self<span class="sc">$</span>state<span class="sc">$</span>cnames)</span>
<span id="cb694-18"><a href="extending-pipeops.html#cb694-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb694-19"><a href="extending-pipeops.html#cb694-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb694-20"><a href="extending-pipeops.html#cb694-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>This can be tested using the first five rows of the “Iris” <code>Task</code>, for which one feature (<code>"Petal.Width"</code>) is constant:</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="extending-pipeops.html#cb695-1" aria-hidden="true" tabindex="-1"></a>irishead <span class="ot">=</span> task<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb695-2"><a href="extending-pipeops.html#cb695-2" aria-hidden="true" tabindex="-1"></a>irishead<span class="sc">$</span><span class="fu">data</span>()</span></code></pre></div>
<pre><code>##    Species Petal.Length Petal.Width Sepal.Length Sepal.Width
## 1:  setosa          1.4         0.2          5.1         3.5
## 2:  setosa          1.4         0.2          4.9         3.0
## 3:  setosa          1.3         0.2          4.7         3.2
## 4:  setosa          1.5         0.2          4.6         3.1
## 5:  setosa          1.4         0.2          5.0         3.6</code></pre>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="extending-pipeops.html#cb697-1" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> Graph<span class="sc">$</span><span class="fu">new</span>()<span class="sc">$</span><span class="fu">add_pipeop</span>(PipeOpDropConst<span class="sc">$</span><span class="fu">new</span>())</span>
<span id="cb697-2"><a href="extending-pipeops.html#cb697-2" aria-hidden="true" tabindex="-1"></a>dropped_task <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">train</span>(irishead)[[<span class="dv">1</span>]]</span>
<span id="cb697-3"><a href="extending-pipeops.html#cb697-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-4"><a href="extending-pipeops.html#cb697-4" aria-hidden="true" tabindex="-1"></a>dropped_task<span class="sc">$</span><span class="fu">data</span>()</span></code></pre></div>
<pre><code>##    Species Petal.Length Sepal.Length Sepal.Width
## 1:  setosa          1.4          5.1         3.5
## 2:  setosa          1.4          4.9         3.0
## 3:  setosa          1.3          4.7         3.2
## 4:  setosa          1.5          4.6         3.1
## 5:  setosa          1.4          5.0         3.6</code></pre>
<p>We can also see that the <code>$state</code> was correctly set.
Calling <code>$.predict()</code> with this graph, even with different data (the whole Iris <code>Task</code>!) will still drop the <code>"Petal.Width"</code> column, as it should.</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="extending-pipeops.html#cb699-1" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span>pipeops<span class="sc">$</span>drop.const<span class="sc">$</span>state</span></code></pre></div>
<pre><code>## $cnames
## [1] &quot;Petal.Length&quot; &quot;Sepal.Length&quot; &quot;Sepal.Width&quot; 
## 
## $affected_cols
## [1] &quot;Petal.Length&quot; &quot;Petal.Width&quot;  &quot;Sepal.Length&quot; &quot;Sepal.Width&quot; 
## 
## $intasklayout
##              id    type
## 1: Petal.Length numeric
## 2:  Petal.Width numeric
## 3: Sepal.Length numeric
## 4:  Sepal.Width numeric
## 
## $outtasklayout
##              id    type
## 1: Petal.Length numeric
## 2: Sepal.Length numeric
## 3:  Sepal.Width numeric
## 
## $outtaskshell
## Empty data.table (0 rows and 4 cols): Species,Petal.Length,Sepal.Length,Sepal.Width</code></pre>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="extending-pipeops.html#cb701-1" aria-hidden="true" tabindex="-1"></a>dropped_predict <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(task)[[<span class="dv">1</span>]]</span>
<span id="cb701-2"><a href="extending-pipeops.html#cb701-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb701-3"><a href="extending-pipeops.html#cb701-3" aria-hidden="true" tabindex="-1"></a>dropped_predict<span class="sc">$</span><span class="fu">data</span>()</span></code></pre></div>
<pre><code>##        Species Petal.Length Sepal.Length Sepal.Width
##   1:    setosa          1.4          5.1         3.5
##   2:    setosa          1.4          4.9         3.0
##   3:    setosa          1.3          4.7         3.2
##   4:    setosa          1.5          4.6         3.1
##   5:    setosa          1.4          5.0         3.6
##  ---                                                
## 146: virginica          5.2          6.7         3.0
## 147: virginica          5.0          6.3         2.5
## 148: virginica          5.2          6.5         3.0
## 149: virginica          5.4          6.2         3.4
## 150: virginica          5.1          5.9         3.0</code></pre>
</div>
<div id="example-pipeopscalealwayssimple" class="section level4" number="6.3.3.2">
<h4><span class="header-section-number">6.3.3.2</span> Example: <code>PipeOpScaleAlwaysSimple</code></h4>
<p>This example will show how a <code>PipeOpTaskPreprocSimple</code> can be used when only working on feature data in form of a <code>data.table</code>.
Instead of calling the <code>scale()</code> function, the <code>center</code> and <code>scale</code> values are calculated directly and saved to the <code>$state</code> slot.
The <code>.transform_dt()</code> function will then perform the same operation during both training and prediction: subtract the <code>center</code> and divide by the <code>scale</code> value.
As in the <a href="extending-pipeops.html#example-pipeopscalealways"><code>PipeOpScaleAlways</code> example above</a>, we use <code>.select_cols()</code> so that we only work on numeric columns.</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="extending-pipeops.html#cb703-1" aria-hidden="true" tabindex="-1"></a>PipeOpScaleAlwaysSimple <span class="ot">=</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(<span class="st">&quot;PipeOpScaleAlwaysSimple&quot;</span>,</span>
<span id="cb703-2"><a href="extending-pipeops.html#cb703-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> mlr3pipelines<span class="sc">::</span>PipeOpTaskPreprocSimple,</span>
<span id="cb703-3"><a href="extending-pipeops.html#cb703-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb703-4"><a href="extending-pipeops.html#cb703-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">id =</span> <span class="st">&quot;scale.always.simple&quot;</span>) {</span>
<span id="cb703-5"><a href="extending-pipeops.html#cb703-5" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">initialize</span>(<span class="at">id =</span> id)</span>
<span id="cb703-6"><a href="extending-pipeops.html#cb703-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb703-7"><a href="extending-pipeops.html#cb703-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb703-8"><a href="extending-pipeops.html#cb703-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-9"><a href="extending-pipeops.html#cb703-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb703-10"><a href="extending-pipeops.html#cb703-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.select_cols =</span> <span class="cf">function</span>(task) {</span>
<span id="cb703-11"><a href="extending-pipeops.html#cb703-11" aria-hidden="true" tabindex="-1"></a>      task<span class="sc">$</span>feature_types[type <span class="sc">==</span> <span class="st">&quot;numeric&quot;</span>, id]</span>
<span id="cb703-12"><a href="extending-pipeops.html#cb703-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb703-13"><a href="extending-pipeops.html#cb703-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-14"><a href="extending-pipeops.html#cb703-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.get_state_dt =</span> <span class="cf">function</span>(dt, levels, target) {</span>
<span id="cb703-15"><a href="extending-pipeops.html#cb703-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb703-16"><a href="extending-pipeops.html#cb703-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">center =</span> <span class="fu">sapply</span>(dt, mean),</span>
<span id="cb703-17"><a href="extending-pipeops.html#cb703-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="fu">sapply</span>(dt, sd)</span>
<span id="cb703-18"><a href="extending-pipeops.html#cb703-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb703-19"><a href="extending-pipeops.html#cb703-19" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb703-20"><a href="extending-pipeops.html#cb703-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb703-21"><a href="extending-pipeops.html#cb703-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.transform_dt =</span> <span class="cf">function</span>(dt, levels) {</span>
<span id="cb703-22"><a href="extending-pipeops.html#cb703-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>((<span class="fu">t</span>(dt) <span class="sc">-</span> self<span class="sc">$</span>state<span class="sc">$</span>center) <span class="sc">/</span> self<span class="sc">$</span>state<span class="sc">$</span>scale)</span>
<span id="cb703-23"><a href="extending-pipeops.html#cb703-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb703-24"><a href="extending-pipeops.html#cb703-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb703-25"><a href="extending-pipeops.html#cb703-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We can compare this <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a> to the one above to show that it behaves the same.</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="extending-pipeops.html#cb704-1" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> Graph<span class="sc">$</span><span class="fu">new</span>()<span class="sc">$</span><span class="fu">add_pipeop</span>(PipeOpScaleAlways<span class="sc">$</span><span class="fu">new</span>())</span>
<span id="cb704-2"><a href="extending-pipeops.html#cb704-2" aria-hidden="true" tabindex="-1"></a>result_posa <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">train</span>(task)[[<span class="dv">1</span>]]</span>
<span id="cb704-3"><a href="extending-pipeops.html#cb704-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-4"><a href="extending-pipeops.html#cb704-4" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> Graph<span class="sc">$</span><span class="fu">new</span>()<span class="sc">$</span><span class="fu">add_pipeop</span>(PipeOpScaleAlwaysSimple<span class="sc">$</span><span class="fu">new</span>())</span>
<span id="cb704-5"><a href="extending-pipeops.html#cb704-5" aria-hidden="true" tabindex="-1"></a>result_posa_simple <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">train</span>(task)[[<span class="dv">1</span>]]</span></code></pre></div>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="extending-pipeops.html#cb705-1" aria-hidden="true" tabindex="-1"></a>result_posa<span class="sc">$</span><span class="fu">data</span>()</span></code></pre></div>
<pre><code>##        Species Petal.Length Petal.Width Sepal.Length Sepal.Width
##   1:    setosa      -1.3358     -1.3111     -0.89767     1.01560
##   2:    setosa      -1.3358     -1.3111     -1.13920    -0.13154
##   3:    setosa      -1.3924     -1.3111     -1.38073     0.32732
##   4:    setosa      -1.2791     -1.3111     -1.50149     0.09789
##   5:    setosa      -1.3358     -1.3111     -1.01844     1.24503
##  ---                                                            
## 146: virginica       0.8169      1.4440      1.03454    -0.13154
## 147: virginica       0.7036      0.9192      0.55149    -1.27868
## 148: virginica       0.8169      1.0504      0.79301    -0.13154
## 149: virginica       0.9302      1.4440      0.43072     0.78617
## 150: virginica       0.7602      0.7880      0.06843    -0.13154</code></pre>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="extending-pipeops.html#cb707-1" aria-hidden="true" tabindex="-1"></a>result_posa_simple<span class="sc">$</span><span class="fu">data</span>()</span></code></pre></div>
<pre><code>##        Species Petal.Length Petal.Width Sepal.Length Sepal.Width
##   1:    setosa      -1.3358     -1.3111     -0.89767     1.01560
##   2:    setosa      -1.3358     -1.3111     -1.13920    -0.13154
##   3:    setosa      -1.3924     -1.3111     -1.38073     0.32732
##   4:    setosa      -1.2791     -1.3111     -1.50149     0.09789
##   5:    setosa      -1.3358     -1.3111     -1.01844     1.24503
##  ---                                                            
## 146: virginica       0.8169      1.4440      1.03454    -0.13154
## 147: virginica       0.7036      0.9192      0.55149    -1.27868
## 148: virginica       0.8169      1.0504      0.79301    -0.13154
## 149: virginica       0.9302      1.4440      0.43072     0.78617
## 150: virginica       0.7602      0.7880      0.06843    -0.13154</code></pre>
</div>
</div>
<div id="ext-pipe-hyperpars" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Hyperparameters</h3>
<p><code>mlr3pipelines</code> uses the <a href="https://paradox.mlr-org.com"><code>paradox</code></a> package to define parameter spaces for <code>PipeOp</code>s.
Parameters for <code>PipeOp</code>s can modify their behavior in certain ways, e.g. switch centering or scaling off in the <code>PipeOpScale</code> operator.
The unified interface makes it possible to have parameters for whole <code>Graph</code>s that modify the individual <code>PipeOp</code>’s behavior.
The <code>Graph</code>s, when encapsulated in <code>GraphLearner</code>s, can even be tuned using the tuning functionality in <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a>.</p>
<p>Hyperparameters are declared during initialization, when calling the <code>PipeOp</code>’s <code>$initialize()</code> function, by giving a <code>param_set</code> argument.
The <code>param_set</code> must be a <code>ParamSet</code> from the <code>paradox</code> package; see <a href="searchspace.html#searchspace">the tuning chapter</a> or the <a href="paradox.html#paradox">in-depth <code>paradox</code> chapter</a> for more information on how to define parameter spaces.
After construction, the <code>ParamSet</code> can be accessed through the <code>$param_set</code> slot.
While it is <em>possible</em> to modify this <code>ParamSet</code>, using e.g. the <code>$add()</code> and <code>$add_dep()</code> functions, <em>after</em> adding it to the <code>PipeOp</code>, it is strongly advised against.</p>
<p>Hyperparameters can be set and queried through the <code>$values</code> slot.
When setting hyperparameters, they are automatically checked to satisfy all conditions set by the <code>$param_set</code>, so it is not necessary to type check them.
Be aware that it is always possible to <em>remove</em> hyperparameter values.</p>
<p>When a <code>PipeOp</code> is initialized, it usually does not have any parameter values—<code>$values</code> takes the value <code>list()</code>.
It is possible to set initial parameter values in the <code>$initialize()</code> constructor; this must be done <em>after</em> the <code>super$initialize()</code> call where the corresponding <code>ParamSet</code> must be supplied.
This is because setting <code>$values</code> checks against the current <code>$param_set</code>, which would fail if the <code>$param_set</code> was not set yet.</p>
<p>When using an underlying library function (the <code>scale</code> function in <code>PipeOpScale</code>, say), then there is usually a “default” behaviour of that function when a parameter is not given.
It is good practice to use this default behaviour whenever a parameter is not set (or when it was removed).
This can easily be done when using the <a href="https://mlr3misc.mlr-org.com">mlr3misc</a> library’s <a href="https://mlr3misc.mlr-org.com/reference/invoke.html"><code>mlr3misc::invoke()</code></a> function, which has functionality similar to <a href="https://www.rdocumentation.org/packages/base/topics/do.call"><code>do.call()</code></a>.</p>
<div id="hyperparameter-example-pipeopscale" class="section level4" number="6.3.4.1">
<h4><span class="header-section-number">6.3.4.1</span> Hyperparameter Example: <code>PipeOpScale</code></h4>
<p>How to use hyperparameters can best be shown through the example of <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_scale.html"><code>PipeOpScale</code></a>, which is very similar to the example above, <code>PipeOpScaleAlways</code>.
The difference is made by the presence of hyperparameters.
<a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_scale.html"><code>PipeOpScale</code></a> constructs a <code>ParamSet</code> in its <code>$initialize</code> function and passes this on to the <code>super$initialize</code> function:</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="extending-pipeops.html#cb709-1" aria-hidden="true" tabindex="-1"></a>PipeOpScale<span class="sc">$</span>public_methods<span class="sc">$</span>initialize</span></code></pre></div>
<pre><code>## function (id = &quot;scale&quot;, param_vals = list()) 
## .__PipeOpScale__initialize(self = self, private = private, super = super, 
##     id = id, param_vals = param_vals)
## &lt;environment: namespace:mlr3pipelines&gt;</code></pre>
<p>The user has access to this and can set and get parameters.
Types are automatically checked:</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="extending-pipeops.html#cb711-1" aria-hidden="true" tabindex="-1"></a>pss <span class="ot">=</span> <span class="fu">po</span>(<span class="st">&quot;scale&quot;</span>)</span>
<span id="cb711-2"><a href="extending-pipeops.html#cb711-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pss<span class="sc">$</span>param_set)</span></code></pre></div>
<pre><code>## &lt;ParamSet:scale&gt;
##                id    class lower upper nlevels        default value
## 1:         center ParamLgl    NA    NA       2           TRUE      
## 2:          scale ParamLgl    NA    NA       2           TRUE      
## 3:         robust ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt; FALSE
## 4: affect_columns ParamUty    NA    NA     Inf  &lt;Selector[1]&gt;</code></pre>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="extending-pipeops.html#cb713-1" aria-hidden="true" tabindex="-1"></a>pss<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>center <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb713-2"><a href="extending-pipeops.html#cb713-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pss<span class="sc">$</span>param_set<span class="sc">$</span>values)</span></code></pre></div>
<pre><code>## $robust
## [1] FALSE
## 
## $center
## [1] FALSE</code></pre>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="extending-pipeops.html#cb715-1" aria-hidden="true" tabindex="-1"></a>pss<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>scale <span class="ot">=</span> <span class="st">&quot;TRUE&quot;</span>  <span class="co"># bad input is checked!</span></span></code></pre></div>
<pre><code>## Error in self$assert(xs): Assertion on &#39;xs&#39; failed: scale: Must be of type &#39;logical flag&#39;, not &#39;character&#39;.</code></pre>
<p>How <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_scale.html"><code>PipeOpScale</code></a> handles its parameters can be seen in its <code>$.train_dt</code> method: It gets the relevant parameters from its <code>$values</code> slot and uses them in the <a href="https://mlr3misc.mlr-org.com/reference/invoke.html"><code>mlr3misc::invoke()</code></a> call.
This has the advantage over calling <code>scale()</code> directly that if a parameter is not given, its default value from the <a href="https://www.rdocumentation.org/packages/base/topics/scale"><code>scale()</code></a> function will be used.</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="extending-pipeops.html#cb717-1" aria-hidden="true" tabindex="-1"></a>PipeOpScale<span class="sc">$</span>private_methods<span class="sc">$</span>.train_dt</span></code></pre></div>
<pre><code>## function (dt, levels, target) 
## .__PipeOpScale__.train_dt(self = self, private = private, super = super, 
##     dt = dt, levels = levels, target = target)
## &lt;environment: namespace:mlr3pipelines&gt;</code></pre>
<p>Another change that is necessary compared to <code>PipeOpScaleAlways</code> is that the attributes <code>"scaled:scale"</code> and <code>"scaled:center"</code> are not always present, depending on parameters, and possibly need to be set to default values <span class="math inline">\(1\)</span> or <span class="math inline">\(0\)</span>, respectively.</p>
<p>It is now even possible (if a bit pointless) to call <code>PipeOpScale</code> with both <code>scale</code> and <code>center</code> set to <code>FALSE</code>, which returns the original dataset, unchanged.</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="extending-pipeops.html#cb719-1" aria-hidden="true" tabindex="-1"></a>pss<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>scale <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb719-2"><a href="extending-pipeops.html#cb719-2" aria-hidden="true" tabindex="-1"></a>pss<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>center <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb719-3"><a href="extending-pipeops.html#cb719-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-4"><a href="extending-pipeops.html#cb719-4" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> Graph<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb719-5"><a href="extending-pipeops.html#cb719-5" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span><span class="fu">add_pipeop</span>(pss)</span>
<span id="cb719-6"><a href="extending-pipeops.html#cb719-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-7"><a href="extending-pipeops.html#cb719-7" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">train</span>(task)</span>
<span id="cb719-8"><a href="extending-pipeops.html#cb719-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-9"><a href="extending-pipeops.html#cb719-9" aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">data</span>()</span></code></pre></div>
<pre><code>##        Species Petal.Length Petal.Width Sepal.Length Sepal.Width
##   1:    setosa          1.4         0.2          5.1         3.5
##   2:    setosa          1.4         0.2          4.9         3.0
##   3:    setosa          1.3         0.2          4.7         3.2
##   4:    setosa          1.5         0.2          4.6         3.1
##   5:    setosa          1.4         0.2          5.0         3.6
##  ---                                                            
## 146: virginica          5.2         2.3          6.7         3.0
## 147: virginica          5.0         1.9          6.3         2.5
## 148: virginica          5.2         2.0          6.5         3.0
## 149: virginica          5.4         2.3          6.2         3.4
## 150: virginica          5.1         1.8          5.9         3.0</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="extending-measures.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="extending-tuners.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mlr-org/mlr3book/edit/master/bookdown/06-extending-pipeops.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/mlr-org/mlr3book/commits/master/bookdown/06-extending-pipeops.Rmd",
"text": "Edit history"
},
"view": {
"link": null,
"text": null
},
"download": [["mlr3book.pdf", "PDF"]],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
